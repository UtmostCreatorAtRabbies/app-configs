[
  /* =========================================================
     IMPORTANT (Coordination with your corrected Karabiner)
     - Karabiner EXCLUDES VS Code from Ctrl->Cmd conversion (correct).
     - Therefore VS Code MUST bind real Ctrl shortcuts directly here.
     - Terminal safety preserved via `when: !terminalFocus` (editor only).
     ========================================================= */

  /* =========================================================
     CORE CLIPBOARD & EDITING (Windows muscle memory)
     ========================================================= */

  {
    "key": "ctrl+c",
    "command": "editor.action.clipboardCopyAction",
    "when": "editorTextFocus && !terminalFocus"
  },
  {
    "key": "ctrl+x",
    "command": "editor.action.clipboardCutAction",
    "when": "editorTextFocus && !terminalFocus"
  },
  {
    "key": "ctrl+v",
    "command": "editor.action.clipboardPasteAction",
    "when": "editorTextFocus && !terminalFocus"
  },
  {
    "key": "ctrl+a",
    "command": "editor.action.selectAll",
    "when": "editorTextFocus && !terminalFocus"
  },

  { "key": "ctrl+z", "command": "undo", "when": "!terminalFocus" },
  { "key": "ctrl+shift+z", "command": "redo", "when": "!terminalFocus" },

  /* JetBrains: Ctrl+Y = Delete Line */
  {
    "key": "ctrl+y",
    "command": "editor.action.deleteLines",
    "when": "editorTextFocus && !terminalFocus && !editorReadonly"
  },

  {
    "key": "ctrl+s",
    "command": "workbench.action.files.save",
    "when": "!terminalFocus"
  },
  {
    "key": "ctrl+shift+s",
    "command": "workbench.action.files.saveAs",
    "when": "!terminalFocus"
  },

  /* =========================================================
     WINDOW / MODE (JetBrains-like)
     ========================================================= */

  {
    "key": "ctrl+alt+f11",
    "command": "workbench.action.toggleFullScreen",
    "when": "!terminalFocus"
  },

  /* JetBrains: Ctrl+Shift+F12 = Hide/Show all tool windows (closest = Zen) */
  {
    "key": "ctrl+shift+f12",
    "command": "workbench.action.toggleZenMode",
    "when": "!terminalFocus"
  },

  /* =========================================================
     SEARCH EVERYWHERE / COMMANDS
     ========================================================= */

  /* NOTE: VS Code does NOT natively support "shift shift".
     Keep it (as requested), but it only works if you use an extension that emits it.
     Recommended if you want it functional: "usernamehw.double-shift"
  */
  {
    "key": "shift shift",
    "command": "workbench.action.quickOpen",
    "when": "!terminalFocus"
  },

  {
    "key": "ctrl+shift+a",
    "command": "workbench.action.showCommands",
    "when": "!terminalFocus"
  },

  /* JetBrains: Ctrl+Shift+N = Go to File */
  {
    "key": "ctrl+shift+n",
    "command": "workbench.action.quickOpen",
    "when": "!terminalFocus"
  },

  /* New file */
  {
    "key": "ctrl+n",
    "command": "workbench.action.files.newUntitledFile",
    "when": "!terminalFocus"
  },

  /* JetBrains: Ctrl+Alt+Shift+N = Go to Symbol */
  {
    "key": "ctrl+alt+shift+n",
    "command": "workbench.action.gotoSymbol",
    "when": "!terminalFocus"
  },

  {
    "key": "ctrl+g",
    "command": "workbench.action.gotoLine",
    "when": "!terminalFocus"
  },

  /* JetBrains: Ctrl+E = Recent files (closest) */
  {
    "key": "ctrl+e",
    "command": "workbench.action.quickOpenRecent",
    "when": "!terminalFocus"
  },

  /* JetBrains: Ctrl+Shift+E = Recent locations (closest available) */
  {
    "key": "ctrl+shift+e",
    "command": "workbench.action.showAllEditorsByMostRecentlyUsed",
    "when": "!terminalFocus"
  },

  /* Navigation history */
  {
    "key": "ctrl+alt+left",
    "command": "workbench.action.navigateBack",
    "when": "!terminalFocus"
  },
  {
    "key": "ctrl+alt+right",
    "command": "workbench.action.navigateForward",
    "when": "!terminalFocus"
  },

  /* JetBrains: Ctrl+Shift+Backspace = Last edit location */
  {
    "key": "ctrl+shift+backspace",
    "command": "workbench.action.navigateToLastEditLocation",
    "when": "!terminalFocus"
  },

  /* Tabs (JetBrains: Ctrl+Tab / Ctrl+Shift+Tab) */
  {
    "key": "ctrl+tab",
    "command": "workbench.action.openNextRecentlyUsedEditorInGroup",
    "when": "!terminalFocus"
  },
  {
    "key": "ctrl+shift+tab",
    "command": "workbench.action.openPreviousRecentlyUsedEditorInGroup",
    "when": "!terminalFocus"
  },

  /* JetBrains: Ctrl+F4 close editor, Ctrl+Shift+F4 close all */
  {
    "key": "ctrl+f4",
    "command": "workbench.action.closeActiveEditor",
    "when": "!terminalFocus"
  },
  {
    "key": "ctrl+shift+f4",
    "command": "workbench.action.closeAllEditors",
    "when": "!terminalFocus"
  },

  /* Reopen closed editor */
  {
    "key": "ctrl+shift+t",
    "command": "workbench.action.reopenClosedEditor",
    "when": "!terminalFocus"
  },

  /* =========================================================
     FIND / REPLACE
     ========================================================= */

  { "key": "ctrl+f", "command": "actions.find", "when": "!terminalFocus" },
  {
    "key": "ctrl+r",
    "command": "editor.action.startFindReplaceAction",
    "when": "editorTextFocus && !terminalFocus"
  },

  {
    "key": "f3",
    "command": "editor.action.nextMatchFindAction",
    "when": "editorFocus && !terminalFocus"
  },
  {
    "key": "shift+f3",
    "command": "editor.action.previousMatchFindAction",
    "when": "editorFocus && !terminalFocus"
  },

  {
    "key": "ctrl+shift+f",
    "command": "workbench.action.findInFiles",
    "when": "!terminalFocus"
  },
  {
    "key": "ctrl+shift+r",
    "command": "workbench.action.replaceInFiles",
    "when": "!terminalFocus"
  },

  /* =========================================================
     INTELLISENSE / CODE ACTIONS
     ========================================================= */

  {
    "key": "ctrl+space",
    "command": "editor.action.triggerSuggest",
    "when": "editorTextFocus && !terminalFocus"
  },

  /* Optional second trigger */
  {
    "key": "alt+space",
    "command": "editor.action.triggerSuggest",
    "when": "editorTextFocus && !terminalFocus"
  },

  /* JetBrains: Ctrl+Shift+Space = Parameter info */
  {
    "key": "ctrl+shift+space",
    "command": "editor.action.triggerParameterHints",
    "when": "editorTextFocus && !terminalFocus"
  },

  /* JetBrains: Ctrl+Q = Quick documentation */
  {
    "key": "ctrl+q",
    "command": "editor.action.showHover",
    "when": "editorTextFocus && !terminalFocus"
  },

  /* JetBrains: Alt+Enter = Quick Fix */
  {
    "key": "alt+enter",
    "command": "editor.action.quickFix",
    "when": "editorTextFocus && !terminalFocus && !editorReadonly"
  },

  /* =========================================================
     GO TO DEFINITION / USAGES FAMILY
     ========================================================= */

  /* JetBrains: Ctrl+B = Go to Declaration/Definition */
  {
    "key": "ctrl+b",
    "command": "editor.action.revealDefinition",
    "when": "editorHasDefinitionProvider && editorTextFocus && !terminalFocus"
  },

  /* JetBrains: Ctrl+Alt+B = Go to Implementation */
  {
    "key": "ctrl+alt+b",
    "command": "editor.action.goToImplementation",
    "when": "editorHasImplementationProvider && editorTextFocus && !terminalFocus"
  },

  /* JetBrains: Ctrl+Shift+B = Go to Type */
  {
    "key": "ctrl+shift+b",
    "command": "editor.action.goToTypeDefinition",
    "when": "editorHasTypeDefinitionProvider && editorTextFocus && !terminalFocus"
  },

  /* JetBrains: Ctrl+Shift+I = Quick Definition */
  {
    "key": "ctrl+shift+i",
    "command": "editor.action.peekDefinition",
    "when": "editorHasDefinitionProvider && editorTextFocus && !terminalFocus"
  },

  /* JetBrains: Alt+F7 = Find Usages */
  {
    "key": "alt+f7",
    "command": "editor.action.referenceSearch.trigger",
    "when": "editorHasReferenceProvider && editorTextFocus && !terminalFocus"
  },

  /* JetBrains: Ctrl+F7 = Highlight usages */
  {
    "key": "ctrl+f7",
    "command": "editor.action.wordHighlight.trigger",
    "when": "editorTextFocus && !terminalFocus"
  },

  /* JetBrains: Ctrl+F12 = File structure (closest) */
  {
    "key": "ctrl+f12",
    "command": "workbench.action.gotoSymbol",
    "when": "editorTextFocus && !terminalFocus"
  },

  /* Focus Outline view (Tool Window) */
  {
    "key": "ctrl+alt+f12",
    "command": "outline.focus",
    "when": "!terminalFocus"
  },

  /* JetBrains: Alt+F1 = Select In... (Explorer) */
  {
    "key": "alt+f1",
    "command": "workbench.files.action.showActiveFileInExplorer",
    "when": "!terminalFocus"
  },

  /* =========================================================
     COMMENTS / SELECTION / MULTI-CURSOR
     ========================================================= */

  {
    "key": "ctrl+/",
    "command": "editor.action.commentLine",
    "when": "editorTextFocus && !terminalFocus && !editorReadonly"
  },
  {
    "key": "ctrl+shift+/",
    "command": "editor.action.blockComment",
    "when": "editorTextFocus && !terminalFocus && !editorReadonly"
  },

  /* JetBrains: Ctrl+W / Ctrl+Shift+W expand/shrink selection */

  {
    "key": "ctrl+alt+w",
    "command": "editor.action.selectWord",
    "when": "editorTextFocus && !terminalFocus && !editorReadonly"
  },
  {
    "key": "ctrl+w",
    "command": "editor.action.smartSelect.expand",
    "when": "editorTextFocus && !terminalFocus && !editorReadonly"
  },
  {
    "key": "ctrl+shift+w",
    "command": "editor.action.smartSelect.shrink",
    "when": "editorTextFocus && !terminalFocus && !editorReadonly"
  },

  /* Multi-cursor (JetBrains style) */
  {
    "key": "alt+j",
    "command": "editor.action.addSelectionToNextFindMatch",
    "when": "editorTextFocus && !terminalFocus && !editorReadonly"
  },
  {
    "key": "alt+shift+j",
    "command": "editor.action.addSelectionToPreviousFindMatch",
    "when": "editorTextFocus && !terminalFocus && !editorReadonly"
  },

  /* Select all occurrences */
  {
    "key": "ctrl+alt+j",
    "command": "editor.action.selectHighlights",
    "when": "editorTextFocus && !terminalFocus"
  },

  /* Undo cursor movement (JetBrains: Ctrl+U = soft undo caret) */
  {
    "key": "ctrl+u",
    "command": "cursorUndo",
    "when": "editorTextFocus && !terminalFocus"
  },

  /* =========================================================
     LINE / WORD EDITING
     ========================================================= */

  /* JetBrains: Ctrl+D = Duplicate line */
  {
    "key": "ctrl+d",
    "command": "editor.action.copyLinesDownAction",
    "when": "editorTextFocus && !terminalFocus && !editorReadonly"
  },

  /* Join lines */
  {
    "key": "ctrl+shift+j",
    "command": "editor.action.joinLines",
    "when": "editorTextFocus && !terminalFocus && !editorReadonly"
  },

  /* Insert line after/before */
  {
    "key": "ctrl+enter",
    "command": "editor.action.insertLineAfter",
    "when": "editorTextFocus && !terminalFocus && !editorReadonly"
  },
  {
    "key": "ctrl+alt+enter",
    "command": "editor.action.insertLineBefore",
    "when": "editorTextFocus && !terminalFocus && !editorReadonly"
  },

  /* Move line up/down */
  {
    "key": "shift+alt+down",
    "command": "editor.action.moveLinesDownAction",
    "when": "editorTextFocus && !terminalFocus"
  },
  {
    "key": "shift+alt+up",
    "command": "editor.action.moveLinesUpAction",
    "when": "editorTextFocus && !terminalFocus"
  },

  /* Indent/outdent */
  {
    "key": "ctrl+[",
    "command": "editor.action.outdentLines",
    "when": "editorTextFocus && !terminalFocus"
  },
  {
    "key": "ctrl+]",
    "command": "editor.action.indentLines",
    "when": "editorTextFocus && !terminalFocus"
  },

  /* Word navigation (Windows style) */
  {
    "key": "ctrl+left",
    "command": "cursorWordLeft",
    "when": "editorTextFocus && !terminalFocus"
  },
  {
    "key": "ctrl+right",
    "command": "cursorWordRight",
    "when": "editorTextFocus && !terminalFocus"
  },
  {
    "key": "ctrl+shift+left",
    "command": "cursorWordLeftSelect",
    "when": "editorTextFocus && !terminalFocus"
  },
  {
    "key": "ctrl+shift+right",
    "command": "cursorWordRightSelect",
    "when": "editorTextFocus && !terminalFocus"
  },

  /* Word delete (Windows style) */
  {
    "key": "ctrl+backspace",
    "command": "deleteWordLeft",
    "when": "editorTextFocus && !terminalFocus && !editorReadonly"
  },
  {
    "key": "ctrl+delete",
    "command": "deleteWordRight",
    "when": "editorTextFocus && !terminalFocus && !editorReadonly"
  },

  /* =========================================================
     FORMATTING / IMPORTS
     ========================================================= */

  /* JetBrains: Ctrl+Alt+L = Reformat */
  {
    "key": "ctrl+alt+l",
    "command": "editor.action.formatDocument",
    "when": "editorTextFocus && !terminalFocus && !editorReadonly"
  },

  {
    "key": "ctrl+alt+shift+l",
    "command": "editor.action.formatSelection",
    "when": "editorTextFocus && !terminalFocus && !editorReadonly"
  },

  /* JetBrains: Ctrl+Alt+O = Optimize imports */
  {
    "key": "ctrl+alt+o",
    "command": "editor.action.organizeImports",
    "when": "editorTextFocus && !terminalFocus && !editorReadonly"
  },

  /* Reindent */
  {
    "key": "ctrl+alt+i",
    "command": "editor.action.reindentlines",
    "when": "editorTextFocus && !terminalFocus && !editorReadonly"
  },

  /* =========================================================
     REFACTORING (best-effort VS Code parity)
     ========================================================= */

  /* Rename */
  {
    "key": "shift+f6",
    "command": "editor.action.rename",
    "when": "editorTextFocus && !terminalFocus && !editorReadonly"
  },

  /* Refactor menu */
  {
    "key": "ctrl+alt+shift+t",
    "command": "editor.action.refactor",
    "when": "editorTextFocus && !terminalFocus && !editorReadonly"
  },

  /* Inline */
  {
    "key": "ctrl+alt+n",
    "command": "editor.action.codeAction",
    "args": { "kind": "refactor.inline" },
    "when": "editorTextFocus && !terminalFocus && !editorReadonly"
  },

  /* Extracts (variable/method/constant) */
  {
    "key": "ctrl+alt+v",
    "command": "editor.action.codeAction",
    "args": { "kind": "refactor.extract.variable" },
    "when": "editorTextFocus && !terminalFocus && !editorReadonly"
  },
  {
    "key": "ctrl+alt+m",
    "command": "editor.action.codeAction",
    "args": { "kind": "refactor.extract.function" },
    "when": "editorTextFocus && !terminalFocus && !editorReadonly"
  },
  {
    "key": "ctrl+alt+c",
    "command": "editor.action.codeAction",
    "args": { "kind": "refactor.extract.constant" },
    "when": "editorTextFocus && !terminalFocus && !editorReadonly"
  },

  /* =========================================================
     TOOL WINDOWS (JetBrains Alt+Number)
     ========================================================= */

  {
    "key": "alt+1",
    "command": "workbench.view.explorer",
    "when": "!terminalFocus"
  },
  {
    "key": "alt+2",
    "command": "workbench.view.search",
    "when": "!terminalFocus"
  },
  {
    "key": "alt+3",
    "command": "workbench.view.scm",
    "when": "!terminalFocus"
  },
  {
    "key": "alt+4",
    "command": "workbench.view.debug",
    "when": "!terminalFocus"
  },
  {
    "key": "alt+5",
    "command": "workbench.view.extensions",
    "when": "!terminalFocus"
  },
  {
    "key": "alt+6",
    "command": "workbench.actions.view.problems",
    "when": "!terminalFocus"
  },

  /* Outline tool window (closest) */
  { "key": "alt+7", "command": "outline.focus", "when": "!terminalFocus" },

  /* Output tool window */
  {
    "key": "alt+0",
    "command": "workbench.action.output.toggleOutput",
    "when": "!terminalFocus"
  },

  /* Terminal tool window (JetBrains: Alt+F12) */
  {
    "key": "alt+f12",
    "command": "workbench.action.terminal.toggleTerminal",
    "when": "!terminalFocus"
  },

  /* Close panel */
  {
    "key": "shift+escape",
    "command": "workbench.action.closePanel",
    "when": "!terminalFocus"
  },

  /* =========================================================
     TERMINAL-SPECIFIC (do NOT break real Ctrl semantics)
     ========================================================= */

  /* JetBrains terminal clear */
  {
    "key": "ctrl+l",
    "command": "workbench.action.terminal.clear",
    "when": "terminalFocus"
  },

  /* Correct fix: Ctrl+D should behave like EOF (shell handles it) */
  {
    "key": "ctrl+d",
    "command": "workbench.action.terminal.sendSequence",
    "args": { "text": "\u0004" },
    "when": "terminalFocus"
  },

  /* Optional: safe kill terminal */
  {
    "key": "ctrl+shift+d",
    "command": "workbench.action.terminal.kill",
    "when": "terminalFocus"
  },

  /* =========================================================
     DEBUG (JetBrains-like)
     ========================================================= */

  /* JetBrains: Shift+F9 Debug, Shift+F10 Run */
  {
    "key": "shift+f9",
    "command": "workbench.action.debug.start",
    "when": "!terminalFocus"
  },
  {
    "key": "shift+f10",
    "command": "workbench.action.debug.run",
    "when": "!terminalFocus"
  },

  /* Extra start/run */
  {
    "key": "ctrl+shift+f9",
    "command": "workbench.action.debug.start",
    "when": "!terminalFocus"
  },
  {
    "key": "ctrl+shift+f10",
    "command": "workbench.action.debug.run",
    "when": "!terminalFocus"
  },

  /* Step controls */
  {
    "key": "f8",
    "command": "workbench.action.debug.stepOver",
    "when": "inDebugMode && !terminalFocus"
  },
  {
    "key": "f7",
    "command": "workbench.action.debug.stepInto",
    "when": "inDebugMode && !terminalFocus"
  },
  {
    "key": "shift+f8",
    "command": "workbench.action.debug.stepOut",
    "when": "inDebugMode && !terminalFocus"
  },
  {
    "key": "f9",
    "command": "workbench.action.debug.continue",
    "when": "inDebugMode && !terminalFocus"
  },

  /* Evaluate selection/watch */
  {
    "key": "alt+f8",
    "command": "editor.debug.action.selectionToWatch",
    "when": "inDebugMode && editorTextFocus"
  },

  /* Stop / Restart */
  {
    "key": "ctrl+f2",
    "command": "workbench.action.debug.stop",
    "when": "!terminalFocus"
  },
  {
    "key": "ctrl+shift+f2",
    "command": "workbench.action.debug.restart",
    "when": "!terminalFocus"
  },

  /* Breakpoints */
  {
    "key": "ctrl+f8",
    "command": "editor.debug.action.toggleBreakpoint",
    "when": "editorTextFocus && !terminalFocus"
  },

  /* JetBrains: Ctrl+Shift+F8 = View breakpoints / toggle activation (closest stable built-in) */
  {
    "key": "ctrl+shift+f8",
    "command": "workbench.debug.viewlet.action.toggleBreakpointsActivatedAction",
    "when": "!terminalFocus"
  },

  /* =========================================================
     GIT (Chord prefix to avoid collisions)
     ========================================================= */

  {
    "key": "ctrl+alt+g s",
    "command": "workbench.view.scm",
    "when": "!terminalFocus"
  },
  {
    "key": "ctrl+alt+g c",
    "command": "git.commit",
    "when": "!terminalFocus"
  },
  {
    "key": "ctrl+alt+g shift+c",
    "command": "git.commitStaged",
    "when": "!terminalFocus"
  },
  { "key": "ctrl+alt+g u", "command": "git.pull", "when": "!terminalFocus" },
  { "key": "ctrl+alt+g p", "command": "git.push", "when": "!terminalFocus" },
  { "key": "ctrl+alt+g y", "command": "git.sync", "when": "!terminalFocus" },
  { "key": "ctrl+alt+g f", "command": "git.fetch", "when": "!terminalFocus" },

  /* =========================================================
     SETTINGS / META
     ========================================================= */

  {
    "key": "ctrl+alt+s",
    "command": "workbench.action.openSettings",
    "when": "!terminalFocus"
  },
  {
    "key": "ctrl+alt+shift+s",
    "command": "workbench.action.openSettingsJson",
    "when": "!terminalFocus"
  },
  {
    "key": "ctrl+alt+shift+k",
    "command": "workbench.action.openGlobalKeybindingsFile",
    "when": "!terminalFocus"
  },

  /* =========================================================
   FILE / SYMBOL RENAME (Finder + JetBrains parity)
   ========================================================= */

  /* macOS Finder-style rename file */
  {
    "key": "alt+f2",
    "command": "renameFile",
    "when": "filesExplorerFocus && !inputFocus"
  },

  /* Explicit Explorer F2 rename (safety / consistency) */
  {
    "key": "shift+f6",
    "command": "renameFile",
    "when": "filesExplorerFocus && !inputFocus"
  },

  // Clipboard + Select All for input boxes (Explorer rename, Find/Replace inputs, etc.)
  {
    "key": "ctrl+a",
    "command": "editor.action.selectAll",
    "when": "inputFocus && !terminalFocus"
  },
  {
    "key": "ctrl+c",
    "command": "editor.action.clipboardCopyAction",
    "when": "inputFocus && !terminalFocus"
  },
  {
    "key": "ctrl+x",
    "command": "editor.action.clipboardCutAction",
    "when": "inputFocus && !terminalFocus"
  },
  {
    "key": "ctrl+v",
    "command": "editor.action.clipboardPasteAction",
    "when": "inputFocus && !terminalFocus"
  }
]
